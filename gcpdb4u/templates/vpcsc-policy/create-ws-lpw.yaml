name: ingressPolicy-databricks-lpw-workspace
ingressPolicies:
  - ingressFrom:
      sources:
        - project: "projects/68422481410" ***REMOVED*** regional control plane project
      identities:
        ***REMOVED***   - group:group@corp.com
        ***REMOVED***   - user:user@corp.com
        - serviceAccount:YOUR_GSA@PROJECT.iam.gserviceaccount.com
      resources:
        - "projects/491105714337"  ***REMOVED*** your vpc project id
      operations:
        - serviceName: "compute.googleapis.com"
          methodSelectors:
            - method: "compute.v1.SubnetworksService.Get"
            - method: "compute.v1.NetworksService.Get"
            - method: "compute.v1.SubnetworksService.TestPermissions"
  ***REMOVED******REMOVED*** This is a must have rule
  ***REMOVED*** required to creare storage buckets for databricks file system aka dbfs
  - ingressFrom:
      sources:
        - project: "projects/68422481410" ***REMOVED*** regional control plane project
      identities:
        - serviceAccount:db-[WORKSPACEID]@prod-gcp-[GEO]-[REGION].iam.gserviceaccount.com ***REMOVED*** wsGSA
    ingressTo:
      resources:
        - "projects/553970327688"  ***REMOVED*** your service or workspace project
      operations:
        - serviceName: "storage.googleapis.com"
          methodSelectors:
            - method: "google.storage.buckets.create"
        - serviceName: "compute.googleapis.com"
          methodSelectors:
            - method: "compute.v1.ZonesService.List"

  ***REMOVED******REMOVED*** Only required if you are using CMK
  ***REMOVED******REMOVED*** https://docs.databricks.com/gcp/en/security/keys/customer-managed-keys
  - ingressFrom:
      sources:
        - project: "projects/68422481410" ***REMOVED*** regional control plane project
      identities:
        - serviceAccount:db-[WORKSPACEID]@prod-gcp-[GEO]-[REGION].iam.gserviceaccount.com ***REMOVED*** wsGSA
    ingressTo:
      resources:
        - "projects/553970327688"  ***REMOVED*** your service or workspace project
      operations:
        - serviceName: "cloudkms.googleapis.com"
          methodSelectors:
            - method: "google.cloud.kms.v1.KeyManagementService.Decrypt"
            - method: "google.cloud.kms.v1.KeyManagementService.Encrypt"
  